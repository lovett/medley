---
- name: Create application group
  become: true
  group:
    state=present
    name="{{ project_group }}"

- name: Create application user
  become: true
  user:
    state=present
    name="{{ project_user }}"
    home="{{ project_root }}"
    createhome=no
    system=yes
    append=yes
    groups="{{ project_user }},audio"

- name: Put ansible user in application group
  become: true
  user:
    name="{{ ansible_user }}"
    group="{{ project_user }}"
    append=yes

- name: Create application directories
  become: true
  file:
    path="{{ item }}"
    state=directory
    owner="{{ project_user }}"
    group="{{ project_group }}"
    mode=0775
  with_items:
    - /var/cache/{{ project_name }}
    - /var/cache/{{ project_name }}/speak
    - /var/medley
    - /var/medley/storage

- name: Install system packages
  become: true
  apt:
    name:
      - python3
      - python3-pip
      - python3-dev
      - python3-venv
      - libasound2-dev
      - make
      - nginx-light
      - rsync
    state: latest
