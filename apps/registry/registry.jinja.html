{% extends "base.jinja.html" %}
{% import "macros.jinja.html" as macros %}

{% block stylesheets %}
{{ macros.cacheBustedStylesheet('registry', 'registry.css') }}
{% endblock %}

{% block scripts %}
{{ macros.cacheBustedScript('registry', 'registry.js') }}

{{ macros.vueApp('main', ('discardable-record', 'discard-button', 'clipboard-button')) }}
{% endblock %}


{% block page_body %}

<main>
    {{ macros.svgSymbols("copy", "delete") }}

    <div class="views content-wrapper">
        <ul>
            <li><a href="#search-form" class="{{ "active" if view == "search" }}">Search</a></li>
            <li><a href="#insert-form" class="{{ "active" if view == "add" }}">Add</a></li>
        </ul>
    </div>

    <form id="search-form" class="content-wrapper {{ "hidden" if not view == "search" }}">
        <div class="field">
            <label for="q">Key:</label>
            <input type="text" id="q" name="q" value="{{ q|default('', true) }}"/>
        </div>
        <div class="field">
            <button>Search</button>
        </div>
    </form>

    <form id="insert-form" class="content-wrapper {{ "hidden" if not view == "add" }}">
        <div class="hidden error message"></div>
        <div class="hidden success message">Success!</div>

        <div class="field">
            <label for="key">Key:</label>
            <input type="text" id="key" name="key" value="{{ key|default('', true) }}"/>
        </div>
        <div class="field">
            <label for="comments">Value:</label>
            <textarea id="value" name="value" {% if key and not value %}autofocus="autofocus"{% endif %}>{{ value|default('', true) }}</textarea>
        </div>
        <div class="field">
            <button>Add</button>
        </div>
    </form>

    <div class="content-wrapper">

        {% if (uid or q) and not entries %}
        <p>No entries found.</p>
        {% endif %}

        {% for entry in entries %}
            <discardable-record inline-template url="{{ app_url }}?uid={{ entry.rowid }}">
                <div class="entry" v-bind:style="styles">
                    <header>
                        {{ entry.key }}
                        <div class="actions">
                            <div><clipboard-button target-value="{{ entry.key }}" label="key" /></div>
                            <div><clipboard-button target-id="value-{{ loop.index }}" label="value" /></div>

                            <div>
                                <discard-button tooltip="Delete this entry" />
                            </div>
                        </div>
                    </header>

                    <div>
                        <div id="value-{{ loop.index }}" class="value">{{ entry.value }}</div>
                    </div>
                </div>
            </discardable-record>
        {% endfor %}
    </div>

</main>


{% endblock %}
