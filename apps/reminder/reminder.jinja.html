{% extends "base.jinja.html" %}
{% import "macros.jinja.html" as macros -%}

{% block stylesheets %}
    {{ macros.staticAsset('reminder', 'reminder.css') }}
{% endblock %}

{% block scripts %}
    {{ macros.vueApp('main', ('countdown', 'discardable-record', 'discard-button', '/reminder/static/reminder-form.js', '/reminder/static/reminder-template.js')) }}
{% endblock %}


{% block page_body %}
    {{ macros.svgSymbols("delete") }}
    <main>
        {% if upcoming %}
            <div class="band">
                <div id="scheduled-reminders" class="content-wrapper">

                    <h1>Upcoming Reminders</h1>

                    {% for event in upcoming %}
                        <discardable-record inline-template url="{{ app_url }}?uid={{ event.time }}">
                            <div class="upcoming-reminder" v-bind:style="styles">
                                <div><discard-button tooltip="Delete this reminder" /></div>
                                <div class="summary">
                                    <time datetime="{{ event.time * 1000 }}">
                                        {{ event.time|localtime|dateformat("LT") }}
                                    </time>
                                    {{ event.argument[1].title }}
                                    <div class="remaining smaller">
                                        <countdown v-bind:expiration-seconds="{{ event.time }}" />
                                    </div>
                                </div>
                            </div>
                        </discardable-record>

                    {% endfor %}

                </div>
            </div>
        {% endif %}

        <div class="content-wrapper">

            <reminder-form inline-template>
                <form ref="reminderForm" id="reminder-form" method="post" action="{{ app_url }}">
                    <div class="{% if not error %}hidden{% endif %} error message">{{ error }}</div>

                    {% if templates %}
                        <h1>Templates</h1>
                        <div class="template-container">
                            {% for id, template in templates.items() %}
                                <reminder-template
                                    inline-template
                                    uid="{{ id }}"
                                    message="{{ template.message }}"
                                    v-bind:minutes="{{ template.minutes }}"
                                    comments="{{ template.comments }}"
                                    notification-id="{{ template.notification_id }}"
                                    url="{{ template.url }}"
                                >
                                    <div v-if="visible" class="template">
                                        <a v-on:click="apply" id="{{ template.notification_id }}" class="summary" href="#">
                                            {{ template.message }}
                                            <br/>
                                            <span class="smaller">
                                                {{ template.duration_in_words }}
                                                {%- if template.notification_id %}
                                                    / #{{ template.notification_id }}
                                                {%- endif -%}
                                            </span>
                                        </a>
                                        <discardable-record inline-template url="{{ template.delete_url }}">
                                            <div><discard-button tooltip="Delete this template" /></div>
                                        </discardable-record>
                                    </div>
                                </reminder-template>
                                {% endfor %}
                            </div>
                    {% endif %}

                    <h1>New Reminder</h1>
                    <div class="field">
                        <label for="hours">Send in</label>

                        <span class="inline-container">
                            <input v-model="hours" type="text" class="inline numeric" id="hours" name="hours" />
                            hours
                        </span>

                        <span class="inline-container">
                            <input v-model="minutes" type="text" class="inline numeric" id="minutes" name="minutes"/>
                            minutes
                        </span>
                    </div>
                    <div class="field">
                        <label for="message">Message</label>
                        <input v-model="message" type="text" id="message" name="message" />
                    </div>

                    <div class="field">
                        <label for="comments">Comments</label>
                        <textarea v-model="comments" id="comments" name="comments"></textarea>
                    </div>

                    <div class="field">
                        <label for="notification_id">Notification ID</label>
                        <input v-model="notificationId" type="text" id="notification_id" name="notification_id" />
                    </div>

                    <div class="field">
                        <label for="url">URL</label>
                        <input v-model="url" type="text" id="url" name="url" />
                        <div class="shortcuts">
                            <a href="#" class="set-url" data-url="{{ app_url }}">this page</a>
                        </div>
                    </div>

                    <div class="field">
                        <input type="checkbox" id="remember" name="remember" value="1" />
                        <label for="remember" class="inline">Make this a template</later>
                    </div>

                    <div class="field">
                        <button data-default="Save" data-alt="Please wait">Save</button>
                    </div>
                </form>
            </reminder-form>
        </div>
    </main>
{% endblock %}
