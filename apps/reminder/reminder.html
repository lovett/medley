{% extends "base.html" %}
{% import "macros.html" as macros -%}

{% block page_meta %}
<meta name="lang.time.hour" content="hour,hours" />
<meta name="lang.time.minute" content="minute,minutes" />
<meta name="lang.time.second" content="second,seconds" />
<meta name="lang.time.in" content="in" />
{% endblock %}

{% block stylesheets %}
{{ macros.cacheBustedStylesheet('reminder', 'reminder.css') }}
{% endblock %}

{% block scripts %}
{{ macros.cacheBustedScript('reminder', 'reminder.js') }}
{% endblock %}


{% block page_body %}

<main>
    {% if upcoming %}
    <div class="band">
        <div id="scheduled-reminders" class="content-wrapper">

            <h1>Scheduled</h1>

            {% for event in upcoming %}
            <div class="upcoming-reminder">
                <a class="delete-reminder" data-uid="{{ event.time }}" href="#">
                    <svg class="icon icon-bin"><use xlink:href="#icon-bin"></use></svg>
                </a>
                <div class="summary">
                    <time datetime="{{ event.time * 1000 }}">
                        {{ event.time|localtime(format="time12_short") }}
                    </time>
                    {{ event.argument[1].title }}
                    <p class="remaining smaller">calculating time remaining...</p>
                </div>
            </div>

            {% endfor %}

        </div>
    </div>
    {% endif %}

    <div class="content-wrapper">

        <form id="reminder-form" method="post" action="{{ url }}">
            <div class="{% if not error %}hidden{% endif %} error message">{{ error }}</div>

            {% if templates %}
            <div class="template-container">
                {% for id, template in templates.items() %}
                <div class="template">
                    <a href="#" class="delete-template" data-uid="{{ id }}">
                        <svg class="icon icon-bin"><use xlink:href="#icon-bin"></use></svg>
                    </a>
                    <a class="summary" href="#" data-uid="{{ id }}" data-message="{{ template.message }}" data-minutes="{{ template.minutes }}" data-comments="{{ template.comments }}">
                        {{ template.message }}
                        <br/>
                        <span class="smaller">{{ template.minutes|pluralize('minute', 'minutes') }}</span>
                    </a>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="field">
                <label for="message">Message</label>
                <input type="text" id="message" name="message" value="{{ message|default('', true)|e }}"/>
            </div>

            <div class="field">
                Send in
                <input type="text" class="inline" id="minutes" name="minutes" value="{{ delivery|default('', true)|e }}"/>
                minutes
            </div>

            <div class="field">
                <label for="comments">Comments</label>
                <textarea id="comments" name="comments">{{ comments|default('', true)|e }}</textarea>
            </div>

            <div class="field">
                <input type="checkbox" id="remember" name="remember" value="1" />
                <label for="remember" class="inline">Make this a template</later>
            </div>

            <div class="field">
                <button data-default="Save" data-alt="Please wait">Save</button>
            </div>
        </form>
    </div>
</main>

{% endblock %}
