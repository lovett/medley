{% extends "base.jinja.html" %}
{% import "macros.jinja.html" as macros -%}

{% set body_id = 'startpage-display' %}


{% block stylesheets %}
{{ macros.cacheBustedStylesheet('startpage', 'startpage.css') }}

<style type="text/css">
    A[href^="{{anonymizer_url}}"] {
        color: #369;
        font-style: normal;
    }
</style>

{% endblock %}

{% block page_meta %}
<meta name="anonymizer" content="{{ anonymizer_url }}"/>
{% endblock %}


{% block page_header %}
{# This view does not display the standard header. #}
{% endblock %}

{% block page_body %}

<main>
    <div class="content-wrapper">
        {% for section in page.sections() if not section.startswith("-") %}
        <section id="{{ section|slug }}">
            <h1>
                <a href="#{{ section|slug }}" title="#{{ section|slug }}">{{ section }}</a>
            </h1>
            <ul>
                {% for url, title in page.items(section): -%}

                {%- if loop.first -%}
                <li>
                    {%- endif -%}

                    {%- if not title.startswith("+") and not loop.first -%}
                </li>
                <li>
                    {% endif %}

                    {%- if title.startswith("+") -%}
                    {{ macros.link(title[1:], url, ",") }}
                    {%- else -%}
                    {{ macros.link(title, url) }}
                    {%- endif -%}

                    {% if loop.last -%}
                </li>
                {% endif -%}

                {% endfor %}
            </ul>
        </section>
        {% endfor %}

        <section>
            <ul>
                <li>
                    <time id="modified" datetime="{{ created|localtime }}"></time>
                </li>
                {% if anonymizer_url %}
                <li>
                    <label>
                        <input type="checkbox" id="anonymize" value="1" disabled="disabled" checked="false"/>
                        Anonymize links
                    </label>
                </li>
                {% endif %}
                <li>
                    <a href="{{ edit_url }}">Edit page</a>
                </li>

                <li class="focus-buffer-display"></li>
            </ul>
        </section>
    </div>
</main>
{% endblock %}

{% block scripts %}
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('{{ worker_url }}').then(registration => {
                console.info(`Service worker registered with scope ${registration.scope}`);
            }).catch(error => console.error(error));
        } else {
            console.info('Service workers are not supported here.');
        }
    </script>
    {{ macros.cacheBustedScript('shared', 'js/focus-as-you-type.js') }}
    {{ macros.cacheBustedScript('startpage', 'startpage.js') }}
{% endblock %}
