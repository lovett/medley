{% extends "base.jinja.html" %}
{% import "macros.jinja.html" as macros -%}

{% block page_body %}
    <main>
        {{ macros.svgSymbols("search") }}

        <header class="app-nav">
            <form method="get" action="/phone">
                <div class="{% if not error %}hidden{% endif %} error message">{{ error }}</div>
                <div class="field">
                    <label for="number">Number</label>
                    <input type="text" id="number" name="number" placeholder="enter a phone number or area code" value="{{ number }}"/>
                </div>
                <div class="field">
                    <button>
                        <svg class="icon"><use xlink:href="#icon-search"></use></svg>
                    </button>
                </div>
            </form>
            <div class="field">
                {% if number %}
                    <a href="{{ app_url }}">Cancel</a>
                {% endif %}
            </div>
        </header>

        {% if number %}
            <section class="page-section">
                <h2>{{ number|phonenumber }}</h2>

                {% if comment %}
                    <p>{{ comment }}</p>
                {% endif %}

                <p>Search on {{ number|websearch("google") }}, {{ number|websearch("bing") }}</p>
            </section>

            <section class="page-section">

                {% if history %}
                    <h2>History</h2>

                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Duration</th>
                                <th>Direction</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for entry in history %}
                                <tr>
                                    <td nowrap>{{ entry["date"]|localtime|dateformat("YYYY-MM-DD") }}</td>
                                    <td nowrap>{{ entry["date"]|localtime|dateformat("LT")}}</td>
                                    <td>{{ entry["duration"] }}</td>
                                    <td>{{ entry["direction"] }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
            </section>
                {% endif %}

                {% if number %}
                    <section class="page-section">
                        <details>
                            <summary>SPARQL</summary>
                            {% for query in sparql %}
                                <pre>{{ query|unindent|escape }}</pre>
                                <p><a href="{{ query|snorql }}" rel="noreferrer" target="_blank">run</a></p>
                            {% endfor %}
                        </details>
                    </section>
                {% endif %}


        {% endif %}
    </main>
{% endblock %}
