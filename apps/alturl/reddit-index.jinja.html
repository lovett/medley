{% extends "apps/alturl/alturl.jinja.html" %}

{% block main_toolbar %}
{% endblock %}

{% block content %}
    <header id="page-title">
        <h2>{{ subreddit }}</h2>
    </header>

    {% if not active_bookmark %}
        <p>
            <a id="add-record" href="#" data-url="{{ subreddit }}">
                <svg class="icon"><use xlink:href="#icon-new-item"></use></svg>
                Bookmark
            </a>
        </p>
    {% endif %}

    <div id="collection">
        <ul>
            {% for story in stories %}
                {% set is_today = story.created|is_today %}
                {% set is_yesterday = story.created|is_yesterday %}
                <li class="headline {% if is_today %}today{% endif %}">
                    <h2 class="title">
                        {% if story.num_comments == 0 and not story.selftext %}
                            {{ story.title|safe|truncate(100) }}
                        {% else %}
                            <a href="{{ story.permalink.alt }}">
                                {{ story.title|safe|truncate(100) }}
                            </a>
                        {% endif %}
                    </h2>
                    <time class="info">

                        {% if is_today %}
                            <svg class="icon"><use xlink:href="#icon-clock"></use></svg>
                            {{ story.created|dateformat("%-I:%M %p") }}
                        {% elif is_yesterday %}
                            <svg class="icon"><use xlink:href="#icon-calendar"></use></svg>
                            yesterday at {{ story.created|dateformat("%-I:%M %p") }}
                        {% else %}
                            <svg class="icon"><use xlink:href="#icon-calendar"></use></svg>
                            {{ story.created|dateformat("%Y-%m-%d %-I:%M %p") }}
                        {% endif %}
                    </time>

                    {# Internally link to the subreddit when not viewing the Reddit homepage. #}
                    {% if "r/" not in url %}
                        <span class="info">
                            <svg class="icon"><use xlink:href="#icon-link"></use></svg>
                            <a href="{{ story.subreddit.alt }}">
                                {{ story.subreddit.text }}
                            </a>
                        </span>
                    {% endif %}

                    {# Externally link to the story URL if not a self-post. #}
                    {% if "self." not in story.domain %}
                        <span class="info">
                            <svg class="icon"><use xlink:href="#icon-link"></use></svg>
                            <a target="_blank" rel="noopeneer noreferrer" href="{{ story.url.anonymized }}">{{ story.domain }}</a>
                        </span>
                    {% endif %}

                    <span class="info">
                        <svg class="icon"><use xlink:href="#icon-comment"></use></svg>
                        {{ story.num_comments|pluralize('comment', 'comments') }}
                    </span>
                </li>

            {% endfor %}
        </ul>
    </div>

{% endblock %}
