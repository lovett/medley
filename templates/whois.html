{% extends "base.html" %}

{% block page_title %}Whois{% if address %} for {{ address }} {% endif %}{% endblock %}

{% block scripts %}
<script src="https://www.google.com/jsapi"></script>
<script src="/static/js/maps.js"></script>
{% endblock %}

{% block body %}

<header>

    {% if not address %}
    <h1>Whois Lookup</h1>

    <form method="get" action="/whois">
        <div class="ui massive icon input">
            <input type="text" id="address" name="address" placeholder="IP Address" autofocus/>
            <i class="search icon"></i>
        </div>
    </form>
    {% else %}

    <p class="next-action"><a href="/whois">Locate another address</a></p>


    {% if country_name == "United States" and city and region_code %}
    <h1>{{ address }}: {{ city }}, {{ region_code }}</h1>
    {% elif city and country_name %}
    <h1>{{ address }}: {{ city }}, {{ country_name }}</h1>
    {% elif country_name %}
    <h1>{{ address }}: {{ country_name }}</h1>
    {% endif %}

    {% if metro_code %}
    <p>Metro: {{ metro_code }}</p>
    {% endif %}

    {% if area_code %}
    <p>Area code: {{ area_code }}</p>
    {% endif %}

    {% endif %}

</header>

<main class="two column stackable divided ui grid">
    <div class="column">
        {% if country_name == "United States" and region_code %}
        <div class="map" data-where="US-{{ region_code }}"></div>
        {% elif country_code %}
        <div class="map" data-where="{{ country_code }}"></div>
        {% endif %}
    </div>
    {% if whois %}

    <div class="wide column">
        <table class="ui small table">
            <tbody>
                {% for line in whois %}

                <tr>
                    <th {% if not line[1] %}colspan="2"{% endif %}>{{ line[0] }}</th>
                    {% if line[1] %}
                    <td>{{ line[1]|urlize(30) }}</td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% endif %}
</main>

{% endblock %}
